---
tags:
  - Linux/Linux_note
---

#### 관련 문서
```dataview
list from #Linux and !#Linux/Linux_note
SORT file.cday DESC
```

##### Linux note
```dataview
list from #Linux/Linux_note
SORT file.name ASC
```


#### vi 실행과 종료
##### vi 실행
```shell
# vi 실행
vi

vi sample1.txt
```
- 파일명을 지정하여 실행할 경우, 기존에 있는 파일명을 지정하면 그 파일을 열고, 새로운 파일명을 지정하면 그 이름의 파일을 새로 만들 수 있다. 지정하지 않으면 파일명이 미정인 신규 파일이 열린다. 

##### vi 종료
- `esc` 키를 누르면 명령모드로 전환되고, 이때 `:q!` 라고 입력하면 파일을 저장하지 않고 vi가 종료된다.

##### vi 모드 변경
- vi에는 실행하는 작업에 따라 세가지 모드가 있다.
- vi명령은 소문자인지, 대문자인지에 따라 동작이 다르므로 주의해야 한다.
![](assets/Linux%20note.png)

- 곤란할 때는 ESC
	- vi를 사용하다가 자신이 어떤 모드에 있는지 알 수 없거나, 편집 작업 등으로 혼란스러운 경우에는 `ESC`키를 누른다. 대부분의 경우에는 명령모드로 돌아갈 수 있으므로 거기서 다시 작업을 진행하자.

#### vi 기본 조작
- vi를 실행하면 새로운 행의 왼쪽 끝에 커서가 표시된다. 
- 신규 작성 팡일의 경우는 화면 왼쪽 상단(첫째 행 첫 문자), <br>기존 파일의 경우는 마지막 행의 다음 행 왼쪽 끝에 표시된다.

##### 인서트 모드로 전환하기 위한 키 정리

| 키  | 모드 변경 후의 상태                                           |
|:---:| ------------------------------------------------------------- |
|  i  | 커서 앞(왼쪽에서부터) 문자를 입력할 수 있다.                  |
|  I  | 커서가 있는 행의 맨 앞에 문자를 입력할 수 있다.               |
|  a  | 커서 다음(오른쪽)부터 문자를 입력할 수 있다.                  |
|  A  | 커서가 있는 행의 끝에서 문자를 입력할 수 있다.                |
|  o  | 커서 한 줄 아래에 행을 삽입하고 그곳에 문자를 입력할 수 있다. |
|  O  | 커서 한 줄 위에 행을 삽입하고 그곳에 문자를 입력할 수 있다.   |

![](assets/Linux%20note-16.png)

##### 커서의 이동
- 커서는 화살표키로 상하좌우 이동한다. 명령모드에서는 알파벳 K J H L 로도 이동할 수 있다. 
![](assets/Linux%20note-17.png)

- 행의 맨 앞으로 이동하려면 ^, 행의 맨 끝으로 이동하려면 $, 파일 마지막 행의 맨 앞으로 이동하려면 G를 입력한다. 
![](assets/Linux%20note-18.png)

#### Vi 기본 조작 
##### 1문자를 삭제(잘라내기)
###### 명령을 사용하지 않는 방법
- 명령을 사용하지 않고 delete키나 backspace 키를 사용해 삭제하는 방법이다.

| 키        | 사용 가능 모드       | 기능                            | 커서 이동 방향    |
| --------- | -------------------- | ------------------------------- | ----------------- |
| Delete    | 삽입모드<br>명령모드 | 커서가 있는 문자를 한 문자 삭제 | 이동하지 않는다   |
| BackSpace | 삽입 모드            | 커서의 왼쪽 문자를 한 문자 삭제 | 왼쪽으로 이동한다 |

###### 명령을 사용하는 방법
- 명령 모드에서 사용 가능 하다

| 명령 | 기능                    |
| ---- | ----------------------- |
| x    | 커서가 있는 문자를 삭제 |
| X    | 커서의 왼쪽 문자를 삭제 |
| J     |  커서가 있는 행의 개행 문자를 삭제   |

##### 행 단위의 삭제(잘라내기)
- 명령모드로 하고, 삭제(잘라내기) 하고 싶은 행에 커서를 이동한 다음 'dd'라고 입력한다.

##### 복사
- 복사하고 싶은 행에 커서를 이동시키고 'yy'라고 입력한다.

##### 붙여넣기
- 커서가 있는 문자 뒤에 붙여놓는 경우는 "p"를 입력한다. 또 커서가 있는 문자 앞에 붙여넣을 경우에는 'P'를 입력한다.


#### 찾기와 바꾸기
- 둘 다 ex 모드로 실행한다

##### 찾기
- 커서가 있는 위치에서 뒤쪽으로 검색하는 경우는 '/'를, 앞쪽으로 검색하는 경우는 '?'를 사용한다. 
	 1. / 또는 ? 를 입력하면 화면 왼쪽 아래에 커서가 표시된다.
	 2. 이어서 검색하고 싶은 문자열을 입력한다.
	 3. `/book` 또는 `?book`

- 보통 찾기 명령은 한번 실행하면 가장 먼저 찾은 키워드에서 멈춘다. 계속해서 검색하고 싶은 경우는 'n'이나 'N'을 입력한다. n은 이전 찾기와 같은 방향으로 검색하고, N은 이전 찾기와 반대 방향으로 검색한다.

##### 바꾸기
- 바꾸기는 's'를 사용해서 실행한다. 파일 안의 모든 문자열을 일괄적으로 바꾸려면 's' 앞에 '%'를 붙여 다음과 같이 실행한다. 
```vim
:%s/book/note/g
# % 파일전체
# , 행을 지정 (1,5... 1행부터 5행째)
# book → 바꾸기 전 문자열
# note → 바꾼 후 문자열 
# g → 바꾸기 방법 (일괄/ 한 건씩 확인하며 바꾸)
```

- 다음과 같이 하면 커서가 있는 행의 맨 앞부터 검색하여 첫번째로 찾은 검색 문자열을 한 건만 바꾼다. 그 외에도 바꿀 후도가 있는 경우는 반전(강조) 표시한다. 
	- 반전표시를 지우려면 ':noh' 라고 입력한다.
```
:s/book/note/
```


#### 저장과 종료
- ex 모드에서 저장하거나 종료할 때 사용하는 명령어.
- 저장, 종료만 각각 수행하는 명령과 같이 수행하는 명령어로 나뉜다.

| 명령      | 기능                           |
| --------- | ------------------------------ |
| :w        | 저장                           |
| :w 파일명 | 다른 이름으로 저장             |
| :w!       | 강제로 저장                    |
| :q        | 파일을 저장하지 않고 종료      |
| :q!       | 파일을 저장하지 않고 강제 종료 |
| :wq       | 파일을 저장하고 종료           |
| :wq!      | 파일을 강제로 저장하고 종료    |

##### vim에서 실수로 강제 종료되었을 때
- Vim은 편집 중인 데이터를 일시적으로 .swp라는 확장자를 가진 파일에 저장한다. 
- 조작 실수 등으로 Vim을 바르게 종료하지 못한 경우에도 .swp 파일은 삭제되지 않고 남아서, 다음에 같은 이름의 파일을 열 때, .swp 파일을 어떻게 할 지 물어본다. 
- 이 때의 옵션은 `R` (Recover :회복)이나 `E` (Edit anyway :강제편집), `Q`(Quit :종료), `A` (Abort :중단)이 있다. 
- .swp 파일은 find 명령 등으로 찾고, 필요 없을 시 rm 명령으로 삭제한다. 